---
  - hosts: all
    gather_facts: true
    remote_user: root

    vars_files:
      - vars/main.yaml

    tasks:
    - name: Create Ansible Service Account
      import_role:
        name: mikepruett3.user_setup
      vars:
        user_account: '{{ ansible_service_user }}'
        user_password_enc: '{{ ansible_service_pass_enc }}'
        user_account_key: '{{ ansible_service_account_key }}'
        key_repository: '{{ key_repo }}'

    - name: Create Regular Account
      import_role:
        name: mikepruett3.user_setup
      vars:
        user_account: '{{ regular_user }}'
        user_password_enc: '{{ regular_pass_enc }}'
        user_account_key: '{{ regular_account_key }}'
        key_repository: '{{ key_repo }}'

    - name: Install libsemanage-python package for Managing SELinux booleans
      package:
        name: 'libsemanage-python'
        state: present

    - name: Import mikepruett3.user_setup role
      import_role:
        name: mikepruett3.user_setup

    - name: Import geerlingguy.repo-epel role
      import_role:
        name: geerlingguy.repo-epel

    - name: Import geerlingguy.security role
      import_role:
        name: geerlingguy.security

    - name: Import geerlingguy.ntp role
      import_role:
        name: geerlingguy.ntp

    - name: Import geerlingguy.clamav role
      import_role:
        name: geerlingguy.clamav

    - name: Set antivirus_can_scan_system SELinux boolean
      seboolean:
        name: antivirus_can_scan_system
        state: yes
        persistent: yes

    - name: Set clamd_use_jit SELinux boolean
      seboolean:
        name: clamd_use_jit
        state: yes
        persistent: yes

    - name: Add ExcludePath's to the scan.conf
      lineinfile:
        path: '{{ clamav_daemon_config_path }}'
        insertafter: 'EOF'
        line: '{{ item }}'
        state: present
      with_items:
        - 'ExcludePath ^/proc/'
        - 'ExcludePath ^/sys/'
        - 'ExcludePath ^/dev/'
        - 'ExcludePath ^/run/'
        - 'ExcludePath ^/var/log/lastlog'
        - 'ExcludePath ^/remotehome/'

    - name: Import geerlingguy.firewall role
      import_role:
        name: geerlingguy.firewall